


ARM Macro Assembler    Page 1 


    1 00000000                 IMPORT           tcb_list
    2 00000000                 IMPORT           current_TCB
    3 00000000                 IMPORT           switch_current_TCB
    4 00000000         
    5 00000000                 PRESERVE8
    6 00000000                 THUMB
    7 00000000         
    8 00000000                 AREA             CODE, CODE, READONLY
    9 00000000         
   10 00000000         PendSV_Handler
                               PROC
   11 00000000                 EXPORT           PendSV_Handler
   12 00000000         
   13 00000000         ; turn off all interrupt
   14 00000000 B672            CPSID            I
   15 00000002         
   16 00000002         
   17 00000002         ; check PSP, if PSP == 0, this is the first task switch
   18 00000002         ; so we can skip 'save context' and 'select next TCB' st
                       ep
   19 00000002 F3EF 8009       MRS              R0, PSP
   20 00000006         ; if r0 == 0, jump to restore_context
   21 00000006         ; LDR R1, =is_first_switch_task
   22 00000006 B158            CBZ              R0, restore_context
   23 00000008         
   24 00000008         save_context
   25 00000008 F3EF 8009       MRS              R0, PSP
   26 0000000C E920 0FF0       STMDB            R0!, {R4-R11}
   27 00000010 4909            LDR              R1, =current_TCB
   28 00000012 6809            LDR              R1, [R1]
   29 00000014 6008            STR              R0, [R1]
   30 00000016         
   31 00000016         select_next_TCB
   32 00000016 B500            PUSH             {LR}
   33 00000018 F7FF FFFE       BL               switch_current_TCB
   34 0000001C F85D EB04       POP              {LR}
   35 00000020         
   36 00000020         restore_context
   37 00000020 4805            LDR              R0, =current_TCB
   38 00000022 6800            LDR              R0, [R0]
   39 00000024 6800            LDR              R0, [R0]
   40 00000026 E8B0 0FF0       LDMIA            R0!, {R4-R11}
   41 0000002A F380 8809       MSR              PSP, R0
   42 0000002E F04E 0E04       ORR              LR, LR, #0x4 ; R1 |= 0x04 : lr 
                                                            |= 32'b0000_0000_00
                                                            00_0100
   43 00000032         
   44 00000032         ; turn on all interrupt
   45 00000032 B662            CPSIE            I
   46 00000034         
   47 00000034         ; return
   48 00000034 4770            BX               LR
   49 00000036         
   50 00000036                 ENDP
   51 00000036         
   52 00000036 BF00            NOP
   53 00000038         
   54 00000038                 END
              00000000 



ARM Macro Assembler    Page 2 


Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M3 --apcs=interw
ork --depend=ez-rtos-rewrite\task_1.d -oez-rtos-rewrite\task_1.o -I.\RTE\_ez-rt
os-rewrite -ID:\Software\KEIL\ARM\CMSIS\5.5.1\CMSIS\Core\Include -ID:\Software\
KEIL\Keil\STM32F1xx_DFP\1.0.5\Device\Include --predefine="__MICROLIB SETA 1" --
predefine="__UVISION_VERSION SETA 528" --predefine="_RTE_ SETA 1" --predefine="
STM32F10X_HD SETA 1" --list=task.lst ..\OS\task.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

CODE 00000000

Symbol: CODE
   Definitions
      At line 8 in file ..\OS\task.s
   Uses
      None
Comment: CODE unused
PendSV_Handler 00000000

Symbol: PendSV_Handler
   Definitions
      At line 10 in file ..\OS\task.s
   Uses
      At line 11 in file ..\OS\task.s
Comment: PendSV_Handler used once
restore_context 00000020

Symbol: restore_context
   Definitions
      At line 36 in file ..\OS\task.s
   Uses
      At line 22 in file ..\OS\task.s
Comment: restore_context used once
save_context 00000008

Symbol: save_context
   Definitions
      At line 24 in file ..\OS\task.s
   Uses
      None
Comment: save_context unused
select_next_TCB 00000016

Symbol: select_next_TCB
   Definitions
      At line 31 in file ..\OS\task.s
   Uses
      None
Comment: select_next_TCB unused
5 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

current_TCB 00000000

Symbol: current_TCB
   Definitions
      At line 2 in file ..\OS\task.s
   Uses
      At line 27 in file ..\OS\task.s
      At line 37 in file ..\OS\task.s

switch_current_TCB 00000000

Symbol: switch_current_TCB
   Definitions
      At line 3 in file ..\OS\task.s
   Uses
      At line 33 in file ..\OS\task.s
Comment: switch_current_TCB used once
tcb_list 00000000

Symbol: tcb_list
   Definitions
      At line 1 in file ..\OS\task.s
   Uses
      None
Comment: tcb_list unused
3 symbols
344 symbols in table
